<!doctype html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Detail Produk ‚Äî Arufkuy Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            glow: "0 0 0 1px rgba(148,163,184,.12), 0 12px 40px rgba(2,6,23,.55)"
          }
        }
      }
    }
  </script>
  <style>
    html {
      scroll-behavior: smooth;
    }

    .grid-bg {
      background-image: radial-gradient(circle at 1px 1px, rgba(148, 163, 184, .14) 1px, transparent 0);
      background-size: 26px 26px;
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>

<body class="min-h-screen bg-slate-950 text-slate-100 font-sans flex flex-col">

  <!-- Top gradient -->
  <div class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-40 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-indigo-500/20 blur-3xl">
    </div>
    <div class="absolute top-40 right-[-140px] h-[380px] w-[380px] rounded-full bg-cyan-500/15 blur-3xl"></div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-50 border-b border-white/10 bg-slate-950/70 backdrop-blur">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-4">
      <a href="index.html" class="flex items-center gap-3">
        <div class="grid h-10 w-10 place-items-center rounded-xl bg-white/5 shadow-glow">
          <span class="text-lg font-bold text-indigo-300">A</span>
        </div>
        <div class="leading-tight">
          <p class="text-sm font-semibold tracking-wide">Arufkuy Store</p>
          <p class="text-xs text-slate-400">Digital Goods</p>
        </div>
      </a>

      <nav class="hidden items-center gap-6 text-sm text-slate-300 md:flex">
        <a href="index.html#products" class="hover:text-white transition">Produk</a>
        <a href="index.html#how" class="hover:text-white transition">Cara Order</a>
        <a href="index.html#faq" class="hover:text-white transition">FAQ</a>
        <a href="index.html#contact" class="hover:text-white transition">Kontak</a>
      </nav>

      <div class="flex items-center gap-3">
        <!-- Desktop Controls -->
        <div class="hidden md:flex items-center gap-3">
          <!-- Language Dropdown -->
          <div class="relative group">
            <button
              class="flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold text-slate-300 hover:bg-white/10 transition">
              <span id="current-lang-flag">üáÆüá©</span>
              <span id="current-lang-text">ID</span>
              <svg class="w-3 h-3 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div
              class="absolute right-0 mt-2 w-32 origin-top-right rounded-xl border border-white/10 bg-slate-900 p-1 shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
              <button onclick="setLanguage('id')"
                class="flex w-full items-center gap-3 rounded-lg px-3 py-2 text-left text-xs text-slate-300 hover:bg-white/10 hover:text-white transition"><span>üáÆüá©</span>
                Indonesia</button>
              <button onclick="setLanguage('en')"
                class="flex w-full items-center gap-3 rounded-lg px-3 py-2 text-left text-xs text-slate-300 hover:bg-white/10 hover:text-white transition"><span>üá∫üá∏</span>
                English</button>
            </div>
          </div>

          <!-- Currency Dropdown -->
          <div class="relative group">
            <button
              class="flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold text-slate-300 hover:bg-white/10 transition">
              <span id="current-curr-symbol" class="text-emerald-400 font-bold">Rp</span>
              <span id="current-curr-text">IDR</span>
              <svg class="w-3 h-3 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div
              class="absolute right-0 mt-2 w-48 max-h-72 overflow-y-auto no-scrollbar origin-top-right rounded-xl border border-white/10 bg-slate-900 p-1 shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
              <div id="currency-dropdown-menu"></div>
            </div>
          </div>

          <a href="index.html#contact"
            class="hidden md:inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-indigo-500 to-cyan-500 px-4 py-2 text-sm font-semibold text-white transition-all duration-300 hover:shadow-lg hover:shadow-cyan-500/40 shadow-lg shadow-indigo-500/30">
            <span>Hubungi</span>
          </a>
        </div>

        <!-- Mobile Hamburger Button -->
        <button onclick="toggleMobileMenu()" class="md:hidden rounded-xl bg-white/5 p-2 hover:bg-white/10 transition">
          <svg id="hamburger-icon" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <svg id="close-icon" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu Dropdown -->
      <div id="mobile-menu"
        class="hidden md:hidden absolute top-20 left-4 right-4 rounded-3xl border border-white/10 bg-slate-950/90 backdrop-blur-xl p-5 shadow-2xl z-[100] transition-all duration-300">

        <!-- Navigation Links -->
        <div class="space-y-1 mb-4">
          <a href="index.html#products" onclick="closeMobileMenu()"
            class="flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition">
            <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
            </svg>
            Produk
          </a>
          <a href="index.html#how" onclick="closeMobileMenu()"
            class="flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition">
            <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
              </path>
            </svg>
            Cara Order
          </a>
          <a href="index.html#faq" onclick="closeMobileMenu()"
            class="flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition">
            <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
              </path>
            </svg>
            FAQ
          </a>
          <a href="index.html#contact" onclick="closeMobileMenu()"
            class="flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition">
            <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
              </path>
            </svg>
            Kontak
          </a>
        </div>

        <div class="border-t border-white/10 pt-4 space-y-3">
          <!-- Language Accordion -->
          <details class="group rounded-xl bg-white/5 border border-white/5 overflow-hidden">
            <summary
              class="flex items-center justify-between px-4 py-3 cursor-pointer hover:bg-white/5 transition select-none list-none">
              <div class="flex items-center gap-3">
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5h12M9 3v2m1.204 8.845a14.523 14.523 0 01-2.922-2.922m-8.601 1.697l7.965-7.965m0 0a17.652 17.652 0 00-6.732-4.147M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                  </path>
                </svg>
                <span class="text-sm font-medium text-slate-300">Bahasa</span>
              </div>
              <svg class="w-4 h-4 text-slate-500 transition-transform group-open:rotate-180" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-4 pb-4 pt-2 grid grid-cols-2 gap-2 bg-black/20">
              <button onclick="setLanguage('id')"
                class="flex items-center justify-center gap-2 rounded-lg bg-white/5 px-3 py-2 text-xs font-medium text-slate-300 hover:bg-white/10 transition border border-white/5">
                <span class="text-base">üáÆüá©</span> Indonesia
              </button>
              <button onclick="setLanguage('en')"
                class="flex items-center justify-center gap-2 rounded-lg bg-white/5 px-3 py-2 text-xs font-medium text-slate-300 hover:bg-white/10 transition border border-white/5">
                <span class="text-base">üá∫üá∏</span> English
              </button>
            </div>
          </details>

          <!-- Currency Accordion -->
          <details class="group rounded-xl bg-white/5 border border-white/5 overflow-hidden">
            <summary
              class="flex items-center justify-between px-4 py-3 cursor-pointer hover:bg-white/5 transition select-none list-none">
              <div class="flex items-center gap-3">
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                  </path>
                </svg>
                <span class="text-sm font-medium text-slate-300">Mata Uang</span>
              </div>
              <svg class="w-4 h-4 text-slate-500 transition-transform group-open:rotate-180" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div id="mobile-currency-menu" class="px-4 pb-4 pt-2 grid grid-cols-2 gap-2 bg-black/20">
              <!-- Currencies will be injected here -->
            </div>
          </details>
        </div>
      </div>
    </div>
  </header>

  <main class="grid-bg min-h-screen flex-grow">
    <div class="mx-auto max-w-6xl px-4 py-10">

      <!-- Breadcrumb -->
      <div class="mb-8 flex items-center gap-2 text-sm text-slate-400">
        <a href="index.html" class="hover:text-white transition">Home</a>
        <span>/</span>
        <span class="text-slate-200">Detail Product</span>
      </div>

      <div id="loading" class="text-center py-20">
        <p class="text-slate-400 animate-pulse">Memuat detail produk...</p>
      </div>

      <div id="product-container" class="hidden gap-10 lg:grid lg:grid-cols-12">
        <!-- Left Column -->
        <div class="lg:col-span-7 space-y-6">
          <div
            class="aspect-video w-full rounded-3xl bg-slate-900 border border-white/10 overflow-hidden shadow-glow relative group">
            <span id="product-image-placeholder"
              class="absolute inset-0 flex items-center justify-center text-slate-500">No Image</span>
            <img id="product-image" src="" alt=""
              class="hidden w-full h-full object-cover transition duration-700 group-hover:scale-105" />
          </div>
          <div class="px-2">
            <h1 id="product-name" class="text-2xl font-bold md:text-3xl lg:text-4xl">Nama Produk</h1>
            <div class="mt-4 prose prose-invert prose-sm max-w-none text-slate-300 leading-relaxed">
              <div id="product-desc"></div>
            </div>
          </div>
        </div>

        <!-- Right Column: Sticky Order Form -->
        <div class="lg:col-span-5 mt-8 lg:mt-0">
          <div
            class="lg:sticky lg:top-24 rounded-3xl border border-white/10 bg-white/5 p-5 md:p-8 shadow-glow backdrop-blur-sm">
            <div class="mb-6 border-b border-white/10 pb-6">
              <div class="flex justify-between items-start">
                <div>
                  <p class="text-sm text-slate-400 mb-1">Harga</p>
                  <div id="price-container">
                    <p id="product-price" class="text-3xl font-bold text-white">Rp 0</p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-sm text-slate-400 mb-1">Stok</p>
                  <div id="product-stock" class="text-lg font-bold"></div>
                </div>
              </div>
              <input type="hidden" id="base-price-idr" value="0">
              <input type="hidden" id="original-price-idr" value="0">
              <input type="hidden" id="total-price-idr" value="0">
            </div>

            <div id="out-of-stock-notice" class="hidden text-center py-10">
              <p class="font-bold text-red-400">Stok Habis</p>
              <p class="text-sm text-slate-400 mt-1">Produk ini tidak tersedia saat ini.</p>
            </div>

            <form id="order-form" class="space-y-4">
              <!-- Variant Selector (Hidden by default) -->
              <div id="variant-section" class="hidden">
                <label class="block text-xs font-medium text-slate-400 mb-2">Pilih Varian</label>
                <div id="variant-options" class="grid grid-cols-1 gap-2">
                  <!-- Options injected here -->
                </div>
                <p id="variant-error" class="text-xs text-red-400 mt-1 hidden">Silakan pilih varian terlebih dahulu.</p>
              </div>
              <!-- Quantity -->
              <div>
                <label class="block text-xs font-medium text-slate-400 mb-1">Jumlah</label>
                <div class="flex items-center gap-3">
                  <button type="button" id="qty-minus"
                    class="grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-slate-800 hover:bg-slate-700 transition disabled:opacity-50 text-lg font-bold">-</button>
                  <input type="text" id="quantity" value="1" readonly
                    class="w-full h-10 rounded-xl border border-white/10 bg-slate-950/50 px-4 text-center text-sm text-white focus:outline-none">
                  <button type="button" id="qty-plus"
                    class="grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-slate-800 hover:bg-slate-700 transition disabled:opacity-50 text-lg font-bold">+</button>
                </div>
              </div>
              <!-- Nama -->
              <div>
                <label class="block text-xs font-medium text-slate-400 mb-1">Nama Lengkap</label>
                <input type="text" id="name" required
                  class="w-full rounded-xl border border-white/10 bg-slate-950/50 px-4 py-3 text-sm text-white focus:border-indigo-500 focus:outline-none transition focus:bg-slate-900"
                  placeholder="Nama Lengkap">
              </div>
              <!-- Email -->
              <div>
                <label class="block text-xs font-medium text-slate-400 mb-1">Alamat Email</label>
                <input type="email" id="email" required
                  class="w-full rounded-xl border border-white/10 bg-slate-950/50 px-4 py-3 text-sm text-white focus:border-indigo-500 focus:outline-none transition focus:bg-slate-900"
                  placeholder="contoh@email.com">
              </div>
              <!-- WhatsApp -->
              <div>
                <label class="block text-xs font-medium text-slate-400 mb-1">Nomor WhatsApp</label>
                <input type="tel" id="phone" required
                  class="w-full rounded-xl border border-white/10 bg-slate-950/50 px-4 py-3 text-sm text-white focus:border-indigo-500 focus:outline-none transition focus:bg-slate-900"
                  placeholder="0812xxxx">
              </div>
              <!-- Kupon -->
              <div>
                <label class="block text-xs font-medium text-slate-400 mb-1">Kode Kupon</label>
                <div class="flex items-center gap-2">
                  <input type="text" id="coupon"
                    class="flex-grow rounded-xl border border-white/10 bg-slate-950/50 px-4 py-3 text-sm text-white focus:border-indigo-500 focus:outline-none transition focus:bg-slate-900"
                    placeholder="Jika ada">
                  <button type="button" id="check-coupon-btn"
                    class="rounded-xl bg-white/5 border border-white/10 px-4 py-3 text-sm font-semibold text-slate-300 hover:bg-white/10 transition">Cek</button>
                </div>
              </div>

              <div class="pt-4">
                <button type="submit" id="pay-btn"
                  class="w-full rounded-xl bg-gradient-to-r from-indigo-500 to-cyan-500 py-4 text-sm font-bold text-white transition-all duration-300 hover:shadow-lg hover:shadow-cyan-500/40 shadow-md shadow-indigo-500/30 disabled:opacity-50 disabled:cursor-not-allowed">Beli
                  Sekarang</button>
              </div>

              <div class="flex items-center justify-center gap-2 text-xs text-slate-500 mt-4">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                  </path>
                </svg>
                <span>Pembayaran via Mayar.</span>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-white/10 mt-auto">
    <div class="mx-auto max-w-6xl px-4 py-8">
      <div class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
        <div class="text-sm text-slate-400">
          <p class="font-semibold text-slate-200">Arufkuy Store</p>
          <p class="mt-1">¬© <span id="footer-year"></span> ‚Ä¢ All rights reserved.</p>
        </div>
        <div class="flex items-center gap-5">
          <a href="#" class="text-slate-400 hover:text-white transition">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M20.317 4.1614C18.87 3.3385 17.253 2.7635 15.529 2.5005C15.423 2.7365 15.331 3.0005 15.253 3.2895C13.84 3.0005 12.365 3.0005 10.964 3.2895C10.886 3.0005 10.794 2.7365 10.688 2.5005C8.964 2.7635 7.347 3.3385 5.899 4.1614C3.431 6.4384 2.356 9.6884 2.501 12.9154C3.83 14.6104 5.62 15.8234 7.688 16.5434C7.923 16.2104 8.132 15.8504 8.305 15.4634C7.923 15.2544 7.562 15.0184 7.229 14.7554C7.151 14.6664 7.073 14.5774 7.001 14.4834C6.013 13.6234 5.224 12.5864 4.687 11.4114C4.634 11.2984 4.581 11.1854 4.533 11.0674C4.532 11.0614 4.532 11.0554 4.531 11.0494C4.515 10.5724 4.593 10.1014 4.766 9.6604C6.073 6.6744 8.69 4.8274 11.999 4.8274C15.308 4.8274 17.925 6.6744 19.232 9.6604C19.405 10.1014 19.483 10.5724 19.467 11.0494C19.466 11.0554 19.466 11.0614 19.465 11.0674C19.417 11.1854 19.364 11.2984 19.311 11.4114C18.774 12.5864 17.985 13.6234 16.997 14.4834C16.925 14.5774 16.847 14.6664 16.769 14.7554C16.436 15.0184 16.075 15.2544 15.693 15.4634C15.866 15.8504 16.075 16.2104 16.31 16.5434C18.378 15.8234 20.168 14.6104 21.498 12.9154C21.681 8.9834 20.317 4.1614 20.317 4.1614ZM9.492 12.4214C8.532 12.4214 7.733 11.5454 7.733 10.4994C7.733 9.4534 8.522 8.5774 9.492 8.5774C10.462 8.5774 11.261 9.4534 11.251 10.4994C11.251 11.5454 10.462 12.4214 9.492 12.4214ZM14.733 12.4214C13.773 12.4214 12.974 11.5454 12.974 10.4994C12.974 9.4534 13.763 8.5774 14.733 8.5774C15.703 8.5774 16.502 9.4534 16.492 10.4994C16.492 11.5454 15.703 12.4214 14.733 12.4214Z" />
            </svg>
          </a>
          <a href="#" class="text-slate-400 hover:text-white transition">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd"
                d="M12.315 2c-4.013 0-4.893.018-6.6.092-1.72.076-2.882.26-3.902.654-.99.384-1.84.89-2.693 1.743-.852.852-1.358 1.704-1.743 2.693-.394 1.02-.578 2.182-.654 3.902C.018 7.422 0 8.302 0 12.315s.018 4.893.092 6.6c.076 1.72.26 2.882.654 3.902.384.99.89 1.84 1.743 2.693.852.852 1.704 1.358 2.693 1.743 1.02.394 2.182.578 3.902.654 1.707.074 2.587.092 6.6.092s4.893-.018 6.6-.092c1.72-.076 2.882-.26 3.902-.654.99-.384 1.84-.89 2.693-1.743.852-.852 1.358-1.704 1.743-2.693.394-1.02.578-2.182.654-3.902.074-1.707.092-2.587.092-6.6s-.018-4.893-.092-6.6c-.076-1.72-.26-2.882-.654-3.902-.384-.99-.89-1.84-1.743-2.693-.852-.852-1.704-1.358-2.693-1.743-1.02-.394-2.182-.578-3.902-.654C17.208 2.018 16.328 2 12.315 2zm0 1.802c3.937 0 4.78.016 6.465.093 1.56.068 2.49.246 3.155.51.78.304 1.35.69 1.92 1.26.57.57.957 1.14 1.26 1.92.265.665.442 1.595.51 3.155.077 1.685.093 2.528.093 6.465s-.016 4.78-.093 6.465c-.068 1.56-.246 2.49-.51 3.155-.304.78-.69 1.35-1.26 1.92-.57.57-1.14.957-1.92 1.26-.665.265-1.595.442-3.155.51-1.685.077-2.528.093-6.465.093s-4.78-.016-6.465-.093c-1.56-.068-2.49-.246-3.155-.51-.78-.304-1.35-.69-1.92-1.26-.57-.57-.957-1.14-1.26-1.92-.265-.665-.442-1.595-.51-3.155-.077-1.685-.093-2.528-.093-6.465s.016-4.78.093-6.465c.068-1.56.246-2.49.51-3.155.304-.78.69-1.35 1.26-1.92.57-.57 1.14-.957 1.92-1.26.665-.265 1.595-.442 3.155-.51C7.535 3.818 8.378 3.802 12.315 3.802zM12 7.31a5 5 0 100 10 5 5 0 000-10zm0 8.198a3.198 3.198 0 110-6.396 3.198 3.198 0 010 6.396zM20.15 5.64a1.44 1.44 0 10-2.88 0 1.44 1.44 0 002.88 0z"
                clip-rule="evenodd" />
            </svg>
          </a>
          <a href="#" class="text-slate-400 hover:text-white transition">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.65 4.31 1.72v3.25c-1.9.04-3.8-.58-5.24-1.96-1.44-1.38-2.2-3.33-2.24-5.35-.01-.02-.01-.03 0 0zM8.35 6.95c.01.02.01.03 0 0-1.4.04-2.81.58-4.02 1.77-1.2 1.19-1.86 2.77-1.86 4.45 0 1.11.25 2.22.75 3.23.51 1.03 1.2 1.93 2.05 2.67.87.76 1.88 1.33 2.98 1.71 1.09.38 2.25.56 3.4.53v-3.26c-1.44-.04-2.88-.59-4.03-1.75-1.15-1.16-1.8-2.73-1.8-4.39 0-.53.08-1.07.24-1.59.16-.52.38-1.01.66-1.46.28-.45.62-.86 1-1.22.39-.36.82-.67 1.28-.93.47-.26.97-.47 1.49-.62.53-.15 1.07-.23 1.61-.25v-3.2c-2.07.08-4.06.88-5.5 2.34-1.44 1.46-2.22 3.45-2.22 5.54 0 1.11.23 2.21.69 3.21.46 1 .08 1.88 1.84 2.63.76.75 1.67 1.33 2.67 1.72 1 .39 2.08.58 3.18.58 1.11 0 2.21-.19 3.22-.58.99-.39 1.9-1.02 2.7-1.77.8-.75 1.46-1.67 1.96-2.71.5-1.04.75-2.15.75-3.26 0-1.68-.65-3.28-1.82-4.45-1.17-1.17-2.76-1.82-4.44-1.82-1.68 0-3.27.65-4.44 1.82-1.17 1.17-1.82 2.77-1.82 4.45 0 .53.08 1.07.24 1.59.16.52.38 1.01.66 1.46.28-.45.62-.86 1 1.22.39-.36.82-.67 1.28-.93.47-.26.97-.47 1.49-.62.53-.15 1.07-.23 1.61-.25v3.2c-2.07-.08-4.06-.88-5.5-2.34-1.44-1.46-2.22-3.45-2.22-5.54z" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Mobile Menu Toggle Functions -->
  <script>
    // Mobile Menu Toggle
    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      const hamburgerIcon = document.getElementById('hamburger-icon');
      const closeIcon = document.getElementById('close-icon');

      if (menu.classList.contains('hidden')) {
        menu.classList.remove('hidden');
        hamburgerIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
      } else {
        menu.classList.add('hidden');
        hamburgerIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
      }
    }

    function closeMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      const hamburgerIcon = document.getElementById('hamburger-icon');
      const closeIcon = document.getElementById('close-icon');

      menu.classList.add('hidden');
      hamburgerIcon.classList.remove('hidden');
      closeIcon.classList.add('hidden');
    }

    // Close mobile menu when clicking outside
    document.addEventListener('click', function (event) {
      const menu = document.getElementById('mobile-menu');
      const button = event.target.closest('button[onclick="toggleMobileMenu()"]');
      const menuContent = event.target.closest('#mobile-menu');

      if (!button && !menuContent && !menu.classList.contains('hidden')) {
        closeMobileMenu();
      }
    });
  </script>
  <!-- Google Translate & Utils -->
  <div id="google_translate_element" style="display:none;"></div>
  <script src="utils.js"></script>
  <script type="text/javascript"
    src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- Toast Notification Container -->
  <div id="toast-container" class="fixed top-4 right-4 z-[9999] flex flex-col gap-3 pointer-events-none"></div>

  <!-- Firebase & Page Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, addDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDtBSbjr5IHmuZqND0MIexw-tWWcZIF33A",
      authDomain: "arufkuy-store.firebaseapp.com",
      projectId: "arufkuy-store",
      storageBucket: "arufkuy-store.firebasestorage.app",
      messagingSenderId: "694416486376",
      appId: "1:694416486376:web:fa36cccffd65557ddc3e5d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Toast Notification System
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');

      const colors = {
        success: 'bg-emerald-500/90 border-emerald-400/50',
        error: 'bg-red-500/90 border-red-400/50',
        warning: 'bg-amber-500/90 border-amber-400/50',
        info: 'bg-indigo-500/90 border-indigo-400/50'
      };

      const icons = {
        success: '‚úì',
        error: '‚úï',
        warning: '‚ö†',
        info: '‚Ñπ'
      };

      toast.className = `${colors[type]} border backdrop-blur-sm text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 min-w-[300px] max-w-md pointer-events-auto transform transition-all duration-300 translate-x-full opacity-0`;
      toast.innerHTML = `
        <span class="text-2xl font-bold">${icons[type]}</span>
        <p class="text-sm font-medium flex-1">${message}</p>
        <button onclick="this.parentElement.remove()" class="text-white/80 hover:text-white text-xl font-bold">√ó</button>
      `;

      container.appendChild(toast);

      // Trigger animation
      setTimeout(() => {
        toast.classList.remove('translate-x-full', 'opacity-0');
      }, 10);

      // Auto remove after 5 seconds
      setTimeout(() => {
        toast.classList.add('translate-x-full', 'opacity-0');
        setTimeout(() => toast.remove(), 300);
      }, 5000);
    }

    const params = new URLSearchParams(window.location.search);
    const productId = params.get("id");

    let productStock = 0;
    let basePrice = 0;
    let originalPrice = 0;
    let isVariableProduct = false;
    let currentVariants = [];
    let selectedVariant = null;
    let appliedCoupon = null;

    function updateTotalPrice() {
      const quantity = parseInt(document.getElementById('quantity').value);

      // Determine effective price
      let effectivePrice = basePrice;
      let effectiveOriginal = originalPrice;

      if (isVariableProduct) {
        if (!selectedVariant) {
          // No variant selected yet, show range or 0
          if (currentVariants.length > 0) {
            // Show range? For now just show "Mulai dari..." in UI, but here we might need a fallback
            // But usually this function is called after interaction
            // If no variant selected, maybe show 0 or min price
          }
          return;
        }
        effectivePrice = selectedVariant.price;
        effectiveOriginal = selectedVariant.original_price || 0;
      }

      const totalPrice = effectivePrice * quantity;
      const totalOriginalPrice = effectiveOriginal * quantity;

      let displayPrice = totalPrice;
      let discountAmount = 0;

      // Calculate discount for display purposes (Mayar will apply actual discount)
      if (appliedCoupon) {
        if (appliedCoupon.type === 'fixed') {
          discountAmount = appliedCoupon.value;
        } else if (appliedCoupon.type === 'percent') {
          discountAmount = Math.floor(totalPrice * (appliedCoupon.value / 100));
        }

        if (discountAmount > totalPrice) discountAmount = totalPrice;
        displayPrice = totalPrice - discountAmount;
      }

      document.getElementById('total-price-idr').value = totalPrice; // Store original price

      const priceContainer = document.getElementById('price-container');
      let priceHtml = '';

      if (appliedCoupon) {
        // Show discounted price
        priceHtml = `
           <div class="flex flex-col items-end">
             <div class="flex items-end gap-2">
               <p class="text-3xl font-bold text-emerald-400">${formatPrice(displayPrice)}</p>
               <p class="text-sm text-slate-500 line-through">${formatPrice(totalPrice)}</p>
             </div>
             <p class="text-xs text-emerald-400">Hemat ${formatPrice(discountAmount)} (${appliedCoupon.code})</p>
           </div>
         `;
      } else {
        priceHtml = `<p class="text-3xl font-bold text-white">${formatPrice(totalPrice)}</p>`;
        if (totalOriginalPrice > totalPrice) {
          priceHtml = `
             <div class="flex items-end gap-2">
               <p class="text-3xl font-bold text-indigo-400">${formatPrice(totalPrice)}</p>
               <p class="text-xl text-slate-500 line-through">${formatPrice(totalOriginalPrice)}</p>
             </div>
           `;
        }
      }

      priceContainer.innerHTML = priceHtml;

      document.getElementById('qty-minus').disabled = (quantity <= 1);
      // For variants, check variant stock
      const limit = isVariableProduct && selectedVariant ? (selectedVariant.stockItems ? selectedVariant.stockItems.length : 0) : productStock;
      document.getElementById('qty-plus').disabled = (quantity >= limit);
    }

    function selectVariant(index) {
      selectedVariant = currentVariants[index];

      // Visual Update
      document.querySelectorAll('.variant-btn').forEach((btn, idx) => {
        if (idx === index) {
          btn.classList.add('border-indigo-500', 'bg-indigo-500/20', 'text-white');
          btn.classList.remove('border-white/10', 'bg-slate-900', 'text-slate-300');
        } else {
          btn.classList.remove('border-indigo-500', 'bg-indigo-500/20', 'text-white');
          btn.classList.add('border-white/10', 'bg-slate-900', 'text-slate-300');
        }
      });

      document.getElementById("variant-error").classList.add("hidden");

      // Update Stock Display
      const vStock = selectedVariant.stockItems ? selectedVariant.stockItems.length : 0;
      const stockElement = document.getElementById("product-stock");

      if (vStock === 0) {
        stockElement.innerHTML = `<span class="text-slate-500">Habis</span>`;
        document.getElementById('pay-btn').disabled = true;
        document.getElementById('pay-btn').innerText = "Stok Habis";
      } else {
        stockElement.innerHTML = `<span class="text-emerald-400">${vStock}</span>`;
        document.getElementById('pay-btn').disabled = false;
        document.getElementById('pay-btn').innerText = "Beli Sekarang";
      }

      // Update Price
      document.getElementById('quantity').value = 1;
      updateTotalPrice();
    }

    function setupQuantityButtons() {
      document.getElementById('qty-plus').addEventListener('click', () => {
        const qtyInput = document.getElementById('quantity');
        let currentQty = parseInt(qtyInput.value);

        const limit = isVariableProduct && selectedVariant ? (selectedVariant.stockItems ? selectedVariant.stockItems.length : 0) : productStock;

        if (currentQty < limit) {
          qtyInput.value = currentQty + 1;
          updateTotalPrice();
        }
      });

      document.getElementById('qty-minus').addEventListener('click', () => {
        const qtyInput = document.getElementById('quantity');
        let currentQty = parseInt(qtyInput.value);
        if (currentQty > 1) {
          qtyInput.value = currentQty - 1;
          updateTotalPrice();
        }
      });
    }

    async function loadProduct() {
      if (!productId) {
        alert("Produk tidak ditemukan");
        window.location.href = "index.html";
        return;
      }

      try {
        const docRef = doc(db, "products", productId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();

          isVariableProduct = !!data.hasVariants;

          document.getElementById("product-name").textContent = data.name;

          const description = data.description || "Tidak ada deskripsi.";
          document.getElementById("product-desc").innerHTML = description.replace(/\n/g, '<br>');

          if (data.image) {
            const img = document.getElementById("product-image");
            img.src = data.image;
            img.classList.remove("hidden");
            document.getElementById("product-image-placeholder").classList.add("hidden");
          }

          if (isVariableProduct) {
            currentVariants = data.variants || [];
            document.getElementById("variant-section").classList.remove("hidden");

            // Render Variants
            const vContainer = document.getElementById("variant-options");
            vContainer.innerHTML = "";

            if (currentVariants.length === 0) {
              vContainer.innerHTML = "<p class='text-sm text-slate-500'>Tidak ada varian tersedia.</p>";
            }

            currentVariants.forEach((v, index) => {
              const btn = document.createElement("button");
              btn.type = "button";
              btn.className = "variant-btn rounded-xl border border-white/10 bg-slate-900 px-4 py-3 text-sm font-medium text-slate-300 hover:border-indigo-500/50 hover:bg-white/5 transition text-left flex justify-between items-center group";
              btn.onclick = () => selectVariant(index);

              const vStock = v.stockItems ? v.stockItems.length : 0;
              const stockStatus = vStock > 0 ? `<span class='text-emerald-400 text-[10px]'>${vStock} Ready</span>` : `<span class='text-red-400 text-[10px]'>Habis</span>`;

              btn.innerHTML = `
                   <span>${v.name}</span>
                   ${stockStatus}
                `;
              vContainer.appendChild(btn);
            });

            // Base Display for Variable Product (Before Selection)
            document.getElementById("price-container").innerHTML = `<p class="text-xl text-slate-400">Pilih varian...</p>`;
            document.getElementById("product-stock").innerHTML = `-`;

            setupQuantityButtons();

          } else {
            // Simple Product Logic
            productStock = Array.isArray(data.stockItems) ? data.stockItems.length : 0;
            basePrice = data.price || 0;
            originalPrice = data.original_price || 0;

            const stockElement = document.getElementById("product-stock");
            if (productStock === 0) {
              stockElement.innerHTML = `<span class="text-slate-500">Stok Habis</span>`;
            } else if (productStock <= 5) {
              stockElement.innerHTML = `<span class="text-red-400">${productStock}</span>`;
            } else if (productStock <= 10) {
              stockElement.innerHTML = `<span class="text-amber-400">${productStock}</span>`;
            } else {
              stockElement.innerHTML = `<span class="text-emerald-400">${productStock}</span>`;
            }

            document.getElementById("base-price-idr").value = basePrice;
            document.getElementById("original-price-idr").value = originalPrice;

            if (productStock > 0) {
              setupQuantityButtons();
              updateTotalPrice();
            } else {
              document.getElementById('order-form').classList.add('hidden');
              document.getElementById('out-of-stock-notice').classList.remove('hidden');
              document.getElementById('price-container').innerHTML = `<p class="text-3xl font-bold text-slate-500">Stok Habis</p>`;
            }
          }

          document.getElementById("loading").classList.add("hidden");
          document.getElementById("product-container").classList.remove("hidden");
        } else {
          alert("Produk tidak ditemukan di database.");
          window.location.href = "index.html";
        }
      } catch (error) {
        console.error("Error fetching product:", error);
        alert("Gagal memuat produk.");
      }
    }

    document.getElementById("order-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      // Validation for Variant
      if (isVariableProduct && !selectedVariant) {
        document.getElementById("variant-error").classList.remove("hidden");
        // Scroll to variant section
        document.getElementById("variant-section").scrollIntoView({ behavior: 'smooth' });
        return;
      }

      // Get form values
      const quantity = parseInt(document.getElementById('quantity').value);
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const coupon = document.getElementById('coupon').value.trim();

      // Validate required fields
      if (!name || !email || !phone) {
        showToast('Silakan lengkapi semua data yang diperlukan', 'warning');
        return;
      }

      // Get product data
      const productName = document.getElementById('product-name').textContent;
      let finalProductName = productName;
      let finalPrice = basePrice;

      if (isVariableProduct && selectedVariant) {
        finalProductName = `${productName} - ${selectedVariant.name}`;
        finalPrice = selectedVariant.price;
      }

      const totalPriceIDR = finalPrice * quantity;

      // Disable submit button and show loading
      const submitBtn = document.getElementById('pay-btn');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="inline-block animate-spin mr-2">‚è≥</span> Memproses...';

      try {
        // Build description with coupon and product ID
        let description = `${finalProductName} - Qty: ${quantity}`;
        if (coupon) {
          description += ` - Kupon: ${coupon}`;
        }
        description += ` - Product ID: ${productId}`;

        // Create pending order in Firestore
        let orderId = 'pending';
        try {
          const orderPayload = {
            customerName: name,
            customerEmail: email,
            customerPhone: phone,
            productName: finalProductName, // Includes variant name
            productId: productId,
            quantity: quantity,
            totalPrice: totalPriceIDR,
            status: 'pending',
            createdAt: new Date(),
            coupon: coupon || null,
            description: description
          };

          if (isVariableProduct && selectedVariant) {
            orderPayload.variantId = selectedVariant.id;
            orderPayload.variantName = selectedVariant.name;
          }

          const orderRef = await addDoc(collection(db, "orders"), orderPayload);
          orderId = orderRef.id;
        } catch (dbError) {
          console.error('Error saving order to Firestore:', dbError);
          showToast('Gagal menyimpan data pesanan. Silakan coba lagi', 'error');
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalBtnText;
          return;
        }

        // Build payload for Cloudflare Worker
        // Calculate net price (Mayar doesn't support couponCode in API)
        let finalItemPrice = finalPrice;
        let itemName = finalProductName;

        if (appliedCoupon) {
          let totalBeforeDiscount = finalPrice * quantity;
          let discountAmount = 0;

          if (appliedCoupon.type === 'fixed') {
            discountAmount = appliedCoupon.value;
          } else if (appliedCoupon.type === 'percent') {
            discountAmount = Math.floor(totalBeforeDiscount * (appliedCoupon.value / 100));
          }

          if (discountAmount > totalBeforeDiscount) discountAmount = totalBeforeDiscount;

          // Calculate price per unit after discount
          finalItemPrice = Math.floor((totalBeforeDiscount - discountAmount) / quantity);
          itemName = `${finalProductName} (Diskon ${appliedCoupon.code})`;
        }

        const payload = {
          name: name,
          email: email,
          mobile: phone,
          description: description,
          redirectUrl: `${window.location.origin}/detail-order.html?orderId=${orderId}&ref={invoiceId}`,
          items: [
            {
              name: itemName,
              quantity: quantity,
              price: finalItemPrice
            }
          ]
        };

        console.log('Sending invoice request:', payload);

        // TODO: Replace with your actual Cloudflare Worker URL
        const WORKER_URL = 'https://payment.arufkuy.workers.dev/create-invoice';

        // Send request to Cloudflare Worker
        const response = await fetch(WORKER_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        const data = await response.json();
        console.log('Worker response:', data);

        // Mayar API returns 'link' not 'url'
        if (response.ok && data.data && data.data.link) {
          // Success - redirect to Mayar payment page
          console.log('Redirecting to payment page:', data.data.link);
          window.location.href = data.data.link;
        } else {
          // Error from API
          throw new Error(data.message || data.error || 'Gagal membuat invoice');
        }

      } catch (error) {
        console.error('Error submitting order:', error);

        // Show error message to user
        showToast(`Terjadi kesalahan: ${error.message}. Silakan coba lagi atau hubungi admin.`, 'error');

        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
      }
    });

    // Check coupon button handler
    document.getElementById('check-coupon-btn').addEventListener('click', async () => {
      const couponInput = document.getElementById('coupon');
      const couponCode = couponInput.value.trim().toUpperCase();

      if (!couponCode) {
        showToast('Masukkan kode kupon terlebih dahulu', 'warning');
        return;
      }

      const checkBtn = document.getElementById('check-coupon-btn');
      const originalText = checkBtn.textContent;
      checkBtn.disabled = true;
      checkBtn.textContent = '...';

      try {
        // Validate against Firestore for instant UI feedback
        const q = query(collection(db, "coupons"), where("code", "==", couponCode), where("isActive", "==", true));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          showToast('Kupon tidak ditemukan atau tidak aktif', 'error');
          appliedCoupon = null;
          updateTotalPrice();
        } else {
          const couponData = querySnapshot.docs[0].data();

          // Validate expiration
          if (couponData.expiredAt && new Date(couponData.expiredAt.toDate()) < new Date()) {
            showToast('Kupon sudah kadaluarsa', 'error');
            appliedCoupon = null;
            updateTotalPrice();
            return;
          }

          // Store coupon (both Firestore data for UI and code for Mayar)
          appliedCoupon = { ...couponData, code: couponCode, id: querySnapshot.docs[0].id };
          showToast(`Kupon ${couponCode} berhasil diterapkan! üéâ`, 'success');

          // Update price display immediately
          updateTotalPrice();

          // Disable further changes
          couponInput.disabled = true;
          checkBtn.textContent = '‚úì';
          checkBtn.disabled = true;
        }

      } catch (error) {
        console.error('Error checking coupon:', error);
        showToast('Gagal memeriksa kupon: ' + error.message, 'error');
        checkBtn.disabled = false;
        checkBtn.textContent = originalText;
      }
    });

    document.getElementById('footer-year').textContent = new Date().getFullYear();

    async function init() {
      await fetchAndUpdateExchangeRate();
      loadProduct();
    }

    init();
  </script>
</body>

</html>