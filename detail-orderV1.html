<!doctype html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Status Pesanan ‚Äî Arufkuy Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            glow: "0 0 0 1px rgba(148,163,184,.12), 0 12px 40px rgba(2,6,23,.55)",
            card: "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out forwards',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>
  <!-- Google Fonts Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(1.6); opacity: 0; }
    }
    .animate-pulse-ring { animation: pulse-ring 2s ease-out infinite; }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.2); border-radius: 99px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(148, 163, 184, 0.4); }

    details summary::-webkit-details-marker { display: none; }
    details summary { list-style: none; }
  </style>
</head>

<body class="min-h-screen bg-[#0B1120] text-slate-200 font-sans flex justify-center p-4 lg:p-8 selection:bg-emerald-500/30">

  <!-- Main Layout Container -->
  <div class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 items-start">

    <!-- ==================== LEFT COLUMN (Status & Info) ==================== -->
    <div class="space-y-6 animate-fade-in">

      <!-- 1. Status Card -->
      <div class="relative overflow-hidden rounded-3xl border border-white/10 bg-slate-900/40 backdrop-blur-md shadow-glow p-6 lg:p-8 text-center lg:text-left flex flex-col lg:flex-row items-center lg:items-start gap-6">
        <!-- Status Icon -->
        <div class="relative shrink-0">
          <div id="status-ring" class="absolute inset-0 rounded-full bg-emerald-500/20 animate-pulse-ring"></div>
          <div id="status-icon" class="relative grid h-20 w-20 place-items-center rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 shadow-[0_0_20px_rgba(16,185,129,0.15)]">
            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
        </div>

        <!-- Status Text -->
        <div class="flex-1 min-w-0 pt-1">
          <h1 id="status-title-text" class="text-2xl lg:text-3xl font-bold text-white tracking-tight mb-2">Memuat...</h1>
          <p id="status-desc-text" class="text-slate-400 text-sm lg:text-base leading-relaxed">
            Sedang memuat data pesanan Anda...
          </p>
        </div>
      </div>

      <!-- 2. Order Details Card -->
      <div class="rounded-3xl border border-white/10 bg-slate-900/40 backdrop-blur-md p-6 lg:p-8 shadow-card">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
            </svg>
            Detail Pesanan
          </h2>
          <span class="px-2.5 py-1 rounded-full bg-white/5 border border-white/5 text-[10px] font-medium text-slate-400">Digital Product</span>
        </div>

        <div class="space-y-4">
          <!-- Order ID -->
          <div class="group relative rounded-2xl bg-slate-950/50 border border-white/5 p-4 hover:border-white/10 transition">
            <p class="text-[10px] text-slate-500 uppercase tracking-wider font-bold mb-1">Order ID / Invoice</p>
            <div class="flex items-center justify-between">
              <p id="ref-id" class="font-mono text-white font-semibold tracking-wide truncate mr-2">...</p>
              <button onclick="copyText(document.getElementById('ref-id').textContent, this)" class="text-slate-500 hover:text-emerald-400 transition p-1.5 rounded-lg hover:bg-white/5" title="Salin ID">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                  <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                </svg>
              </button>
            </div>
          </div>

          <!-- Product -->
          <div class="rounded-2xl bg-slate-950/50 border border-white/5 p-4 hover:border-white/10 transition">
            <p class="text-[10px] text-slate-500 uppercase tracking-wider font-bold mb-1">Produk</p>
            <p id="product-name" class="text-white font-medium leading-snug">...</p>
          </div>

          <!-- Price -->
          <div class="rounded-2xl bg-slate-950/50 border border-white/5 p-4 hover:border-white/10 transition">
            <p class="text-[10px] text-slate-500 uppercase tracking-wider font-bold mb-1">Total Pembayaran</p>
            <p id="product-price" class="text-emerald-400 font-bold text-lg">...</p>
          </div>
        </div>
      </div>

      <!-- 3. Support Info (Desktop: Left Bottom) -->
      <div class="rounded-3xl border border-indigo-500/10 bg-indigo-500/[0.03] p-6 flex gap-4 items-start">
        <div class="p-2 rounded-xl bg-indigo-500/10 text-indigo-400 shrink-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
        </div>
        <div>
          <h3 class="text-sm font-bold text-indigo-200 mb-1">Butuh Bantuan?</h3>
          <p class="text-xs text-indigo-200/60 leading-relaxed">
            Jika produk tidak muncul atau bermasalah, silakan hubungi admin kami dengan menyertakan Order ID Anda.
          </p>
        </div>
      </div>

    </div>

    <!-- ==================== RIGHT COLUMN (Deliverables & Actions) ==================== -->
    <div class="space-y-6 animate-fade-in" style="animation-delay: 0.1s;">

      <!-- 4. Delivered Items Card (Main Content) -->
      <div class="rounded-3xl border border-white/10 bg-slate-900/40 backdrop-blur-md shadow-glow overflow-hidden flex flex-col min-h-[300px]">
        <div class="p-6 border-b border-white/5 bg-white/[0.02] flex items-center justify-between">
          <h2 class="text-sm font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2">
            <span class="h-2 w-2 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)]"></span>
            Produk Anda
          </h2>
          <!-- Optional Badge -->
          <span id="item-count-badge" class="hidden text-[10px] bg-emerald-500/10 text-emerald-400 px-2 py-0.5 rounded border border-emerald-500/20">0 Item</span>
        </div>

        <div class="p-6 flex-1 relative">
          <!-- Placeholder (Empty State) -->
          <div id="delivered-items-placeholder" class="absolute inset-0 flex flex-col items-center justify-center p-8 text-center">
            <div class="w-16 h-16 rounded-full bg-slate-800/50 grid place-items-center mb-4 border border-white/5">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
              </svg>
            </div>
            <h3 id="placeholder-title" class="text-slate-200 font-medium mb-1">Menunggu Proses</h3>
            <p id="placeholder-desc" class="text-sm text-slate-500 max-w-xs">
              Produk akan muncul di sini secara otomatis setelah pembayaran dikonfirmasi.
            </p>
          </div>

          <!-- Items List -->
          <div id="delivered-items-list" class="space-y-3 hidden relative z-10">
            <!-- Items will be injected here -->
          </div>
        </div>
      </div>

      <!-- 5. Buyer Notes (Hidden by default) -->
      <div id="buyer-notes-section" class="hidden rounded-3xl border border-amber-500/20 bg-amber-950/10 p-6">
        <div class="flex items-center gap-2 mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-amber-400" viewBox="0 0 20 20" fill="currentColor">
            <path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" />
          </svg>
          <h2 class="text-xs font-bold text-amber-400 uppercase tracking-widest">Catatan Admin</h2>
        </div>
        <p id="buyer-notes-text" class="text-sm text-amber-200/90 whitespace-pre-wrap leading-relaxed font-medium"></p>
      </div>

      <!-- 6. Action Buttons -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <a href="index.html" class="flex items-center justify-center gap-2 rounded-2xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 hover:border-white/10 py-4 text-sm font-semibold text-slate-300 transition group">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-500 group-hover:text-slate-300 transition" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
          </svg>
          Kembali ke Beranda
        </a>
        <button onclick="viewInvoice()" class="flex items-center justify-center gap-2 rounded-2xl bg-indigo-600/10 hover:bg-indigo-600/20 border border-indigo-500/20 hover:border-indigo-500/30 py-4 text-sm font-semibold text-indigo-400 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
          </svg>
          Lihat Invoice
        </button>
      </div>

      <!-- Branding (Mobile Only) -->
      <div class="lg:hidden text-center pt-6 pb-2">
        <p class="text-[10px] text-slate-600 font-medium">Arufkuy Store &copy; 2024</p>
      </div>

    </div>

  </div>

  <!-- Simple encryption/decryption for local storage (optional) -->
  <script src="utils.js"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, onSnapshot, collection, query, where, getDocs, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDtBSbjr5IHmuZqND0MIexw-tWWcZIF33A",
      authDomain: "arufkuy-store.firebaseapp.com",
      projectId: "arufkuy-store",
      storageBucket: "arufkuy-store.firebasestorage.app",
      messagingSenderId: "694416486376",
      appId: "1:694416486376:web:fa36cccffd65557ddc3e5d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const orderId = params.get("orderId");
    const invoiceIdParam = params.get("invoice") || params.get("id") || params.get("transactionId");
    let refId = params.get("ref");

    if (refId === '{invoiceId}' || refId === null || refId === '') {
      refId = null;
    }

    const legacyProduct = params.get("product");
    const legacyPrice = params.get("price");

    window.copyText = function (text, btn) {
      if (!text) return;
      navigator.clipboard.writeText(text).then(() => {
        if (btn) {
          const originalHTML = btn.innerHTML;
          btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-emerald-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>';
          setTimeout(() => { btn.innerHTML = originalHTML; }, 1500);
        }
      });
    };

    if (invoiceIdParam) {
      if (!params.has("invoice")) {
        const newUrl = new URL(window.location.href);
        newUrl.searchParams.delete("id");
        newUrl.searchParams.delete("transactionId");
        newUrl.searchParams.set("invoice", invoiceIdParam);
        window.history.replaceState({}, '', newUrl);
      }
      findOrderByInvoiceId(invoiceIdParam);
    } else if (orderId) {
      loadOrder(orderId);
    } else if (legacyProduct) {
      document.getElementById("ref-id").textContent = refId || "-";
      document.getElementById("product-name").textContent = legacyProduct;
      document.getElementById("product-price").textContent = "Rp " + new Intl.NumberFormat("id-ID").format(legacyPrice);
      setStatus('paid', false);
    } else {
      setStatus('not-found');
    }

    function setStatus(status, hasItems) {
      const icon = document.getElementById("status-icon");
      const ring = document.getElementById("status-ring");
      const title = document.getElementById("status-title-text");
      const desc = document.getElementById("status-desc-text");
      const placeholderTitle = document.getElementById("placeholder-title");
      const placeholderDesc = document.getElementById("placeholder-desc");

      if (status === 'paid' || status === 'completed') {
        icon.className = "relative grid h-20 w-20 place-items-center rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 shadow-[0_0_20px_rgba(16,185,129,0.15)]";
        ring.className = "absolute inset-0 rounded-full bg-emerald-500/20 animate-pulse-ring";
        icon.innerHTML = '<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';

        if (hasItems) {
          if (title) title.textContent = "Pembayaran Berhasil";
          if (desc) desc.textContent = "Terima kasih! Produk digital Anda sudah dikirim.";
        } else {
          if (title) title.textContent = "Pembayaran Diterima";
          if (desc) desc.textContent = "Pembayaran berhasil! Produk Anda sedang diproses.";
          if (placeholderTitle) placeholderTitle.textContent = "Sedang Memproses";
          if (placeholderDesc) placeholderDesc.textContent = "Pembayaran dikonfirmasi. Produk digital Anda sedang diproses dan akan segera muncul di sini.";
        }
      } else if (status === 'pending') {
        icon.className = "relative grid h-20 w-20 place-items-center rounded-full bg-amber-500/10 text-amber-400 border border-amber-500/20 shadow-[0_0_20px_rgba(245,158,11,0.15)]";
        ring.className = "absolute inset-0 rounded-full bg-amber-500/20 animate-pulse-ring";
        icon.innerHTML = '<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
        if (title) title.textContent = "Menunggu Pembayaran";
        if (desc) desc.textContent = "Silakan selesaikan pembayaran Anda agar produk dapat dikirim.";
        if (placeholderTitle) placeholderTitle.textContent = "Menunggu Pembayaran";
        if (placeholderDesc) placeholderDesc.textContent = "Produk digital Anda akan otomatis dikirim setelah pembayaran dikonfirmasi.";
      } else if (status === 'not-found') {
        icon.className = "relative grid h-20 w-20 place-items-center rounded-full bg-red-500/10 text-red-400 border border-red-500/20";
        ring.className = "absolute inset-0 rounded-full bg-red-500/20";
        ring.style.animation = 'none';
        icon.innerHTML = '<svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
        if (title) title.textContent = "Pesanan Tidak Ditemukan";
        if (desc) desc.textContent = "Mohon periksa kembali link Anda atau hubungi admin.";
      } else {
        if (title) title.textContent = "Status: " + status;
      }
    }

    function loadOrder(id) {
      let pollInterval = null;

      function startPolling() {
        if (pollInterval) return;
        pollInterval = setInterval(async () => {
          try {
            const docSnap = await getDoc(doc(db, "orders", id));
            if (docSnap.exists()) {
              processOrderData(docSnap.data(), id);
            }
          } catch (e) {
            console.warn('Poll error:', e.code || e.message);
          }
        }, 5000);
      }

      function processOrderData(data, currentOrderId) {
        const displayRefId = data.invoiceId || invoiceIdParam || refId || currentOrderId;

        if (data.invoiceId && !invoiceIdParam && params.get("orderId")) {
          const newUrl = new URL(window.location.href);
          newUrl.searchParams.delete("orderId");
          newUrl.searchParams.set("invoice", data.invoiceId);
          window.history.replaceState({}, '', newUrl);
        }

        document.getElementById("ref-id").textContent = displayRefId;
        document.getElementById("product-name").textContent = data.productName;
        document.getElementById("product-price").textContent = "Rp " + new Intl.NumberFormat("id-ID").format(data.totalPrice);

        const itemsToRender = data.deliveredItems || data.stockItems;
        const hasItems = Array.isArray(itemsToRender) && itemsToRender.length > 0;

        setStatus(data.status, hasItems);

        if (data.status === 'paid' || data.status === 'completed') {
          if (hasItems) {
            renderDeliveredItems(itemsToRender);
            if (pollInterval) { clearInterval(pollInterval); pollInterval = null; }
          }

          if (data.buyerNotes) {
            renderBuyerNotes(data.buyerNotes);
          }
        }
      }

      onSnapshot(doc(db, "orders", id), (docSnap) => {
        if (docSnap.exists()) {
          processOrderData(docSnap.data(), id);
        } else {
          setStatus('not-found');
        }
      }, (error) => {
        console.warn("Realtime listener error:", error.code);
        getDoc(doc(db, "orders", id)).then((docSnap) => {
          if (docSnap.exists()) {
            processOrderData(docSnap.data(), id);
            const data = docSnap.data();
            if (data.status === 'pending' || (data.status === 'paid' && !data.deliveredItems)) {
              startPolling();
            }
          } else {
            setStatus('not-found');
          }
        }).catch(() => {
          setStatus('not-found');
        });
      });
    }

    async function findOrderByInvoiceId(invId) {
      try {
        const q = query(collection(db, "orders"), where("invoiceId", "==", invId), limit(1));
        const querySnapshot = await getDocs(q);

        if (!querySnapshot.empty) {
          const doc = querySnapshot.docs[0];
          loadOrder(doc.id);
        } else {
          setStatus('not-found');
        }
      } catch (error) {
        setStatus('not-found');
      }
    }

    function renderDeliveredItems(items) {
      const placeholder = document.getElementById("delivered-items-placeholder");
      const list = document.getElementById("delivered-items-list");
      const badge = document.getElementById("item-count-badge");

      let itemsArray = [];
      if (Array.isArray(items)) {
        itemsArray = items.map(item => {
          if (typeof item === 'string') {
            return { content: item, note: '' };
          }
          return item;
        });
      } else if (items) {
        if (typeof items === 'string') {
          itemsArray = [{ content: items, note: '' }];
        } else {
          itemsArray = [items];
        }
      }

      if (itemsArray.length === 0) return;

      placeholder.classList.add("hidden");
      list.classList.remove("hidden");
      list.innerHTML = "";

      if(badge) {
        badge.textContent = itemsArray.length + " Item";
        badge.classList.remove("hidden");
      }

      itemsArray.forEach((item, index) => {
        const details = document.createElement("details");
        details.className = "group bg-slate-950/30 rounded-xl border border-white/5 overflow-hidden";
        if (index === 0) details.open = true;

        let noteHtml = '';
        if (item.note) {
          noteHtml = `
            <div class="mt-3 flex items-start gap-2 p-3 rounded-lg bg-amber-500/5 border border-amber-500/10">
               <span class="text-amber-400 text-sm">üìù</span>
               <div class="text-xs text-amber-200/80 italic leading-relaxed whitespace-pre-wrap font-sans">${item.note}</div>
            </div>
          `;
        }

        details.innerHTML = `
            <summary class="flex justify-between items-center p-4 cursor-pointer select-none bg-white/[0.02] hover:bg-white/[0.04] transition">
                <div class="flex items-center gap-3">
                    <div class="h-6 w-6 rounded-full bg-emerald-500/10 border border-emerald-500/20 grid place-items-center text-xs font-bold text-emerald-400 font-mono">${index + 1}</div>
                    <span class="text-sm font-medium text-slate-300 group-open:text-white transition">Akun / Produk #${index + 1}</span>
                </div>
                <span class="text-slate-500 transition-transform duration-300 group-open:rotate-180">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </span>
            </summary>
            <div class="p-4 border-t border-white/5 bg-black/20">
              <div class="bg-slate-950 rounded-xl p-4 border border-emerald-500/10 relative group/copy shadow-inner">
                <div class="font-mono text-sm text-emerald-300 break-all whitespace-pre-wrap select-all font-medium pr-8 leading-relaxed">${item.content || 'Content Unavailable'}</div>
                <button onclick="copyText(this.previousElementSibling.innerText, this)" class="absolute top-3 right-3 text-slate-600 hover:text-emerald-400 bg-slate-800/80 hover:bg-slate-800 p-1.5 rounded-lg transition border border-white/5">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                    <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                  </svg>
                </button>
              </div>
              ${noteHtml}
            </div>
          `;
        list.appendChild(details);
      });
    }

    function renderBuyerNotes(notes) {
      const section = document.getElementById("buyer-notes-section");
      const text = document.getElementById("buyer-notes-text");
      section.classList.remove("hidden");
      text.textContent = notes;
    }

    function viewInvoice() {
      const displayedRef = document.getElementById("ref-id").textContent;
      const invoiceId = displayedRef && displayedRef !== '...' && displayedRef !== '-' ? displayedRef : refId;

      if (invoiceId) {
        window.location.href = `https://arufkuy.myr.id/invoices/${invoiceId}`;
      } else {
        alert("Invoice ID belum tersedia.");
      }
    }

    window.viewInvoice = viewInvoice;
  </script>
</body>
</html>